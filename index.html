<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Donation Portal</title>
  <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-database-compat.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    header {
      padding: 20px;
      background: #f4f4f4;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .container {
      padding: 20px;
      max-width: 600px;
      margin: 20px auto;
      font-size: 20px;
      text-align: center;
    }
    form, .admin-panel {
      margin-top: 20px;
    }
    input, button {
      margin: 10px 0;
      padding: 10px;
      font-size: 16px;
      width: 100%;
      box-sizing: border-box;
    }
    .admin-panel {
      margin-top: 40px;
      border-top: 1px solid #ccc;
      padding-top: 20px;
    }
    .code-list {
      margin-top: 10px;
      font-size: 14px;
      word-break: break-word;
      text-align: left;
    }
    #adminPanel {
      display: none;
    }
  </style>
</head>
<body>
  <header>
    <h1>Donation Portal</h1>
  </header>
  <div class="container">
    <p>Admin Login to Generate Donation Codes</p>
    <form id="adminLoginForm">
      <input type="text" id="adminUsername" placeholder="Admin Username" required>
      <input type="password" id="adminPassword" placeholder="Admin Password" required>
      <button type="submit">Login</button>
    </form>

    <div id="adminPanel" class="admin-panel">
      <h3>Admin Panel</h3>
      <p>Generate random codes for donations:</p>
      <form id="adminForm">
        <input type="number" id="numberOfCodes" placeholder="Number of codes to generate" required>
        <input type="number" id="codeAmount" placeholder="Amount for each code" required>
        <button type="submit">Generate Codes</button>
      </form>
      <div class="code-list">
        <strong>Generated Codes:</strong>
        <div id="generatedCodes">None</div>
      </div>
    </div>
  </div>
  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDsp-t5t7djT1fBxpmIg96DPDVuQqTeslY",
      authDomain: "donations-606e1.firebaseapp.com",
      databaseURL: "https://donations-606e1-default-rtdb.firebaseio.com",
      projectId: "donations-606e1",
      messagingSenderId: "887767168841",
      appId: "1:887767168841:web:e98a6d07cd2e80a3730c98"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Admin Login
    const adminLoginForm = document.getElementById('adminLoginForm');
    const adminPanel = document.getElementById('adminPanel');
    const ADMIN_CREDENTIALS = {
      username: 'admin',
      password: 'securepassword123'
    };

    adminLoginForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const username = document.getElementById('adminUsername').value.trim();
      const password = document.getElementById('adminPassword').value.trim();

      if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
        alert('Admin login successful!');
        adminLoginForm.style.display = 'none';
        adminPanel.style.display = 'block';
      } else {
        alert('Invalid admin credentials!');
      }
    });

    // Admin Form Submission (Generate Codes)
    const adminForm = document.getElementById('adminForm');
    const generatedCodesDiv = document.getElementById('generatedCodes');

    adminForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const numberOfCodes = parseInt(document.getElementById('numberOfCodes').value);
      const codeAmount = parseInt(document.getElementById('codeAmount').value);

      if (isNaN(numberOfCodes) || isNaN(codeAmount) || numberOfCodes <= 0) {
        alert('Please provide valid inputs.');
        return;
      }

      const generateRandomCode = () => {
        return `CODE-${Math.random().toString(36).substring(2, 8)}-${Math.random().toString(36).substring(2, 8)}-${Math.random().toString(36).substring(2, 8)}`;
      };

      const updates = {};
      const codesArray = [];

      for (let i = 0; i < numberOfCodes; i++) {
        const randomCode = generateRandomCode();
        updates[`codes/${randomCode}`] = { amount: codeAmount, used: false };
        codesArray.push(randomCode);
      }

      try {
        await db.ref().update(updates);
        generatedCodesDiv.innerText = codesArray.join('\n');
        alert('Codes generated successfully!');
        adminForm.reset();
      } catch (error) {
        console.error('Error generating codes:', error);
        alert('Failed to generate codes. Please try again.');
      }
    });
  </script>
</body>
</html>
